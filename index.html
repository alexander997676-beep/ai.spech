 <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>‚´∑ùêÖùêÄùêä ùêéùêÖùêÖùêàùêÇùêàùêÄùêã‚´∏ - AI TTS</title>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
        <style>
            :root {
                --primary-color: #007cf0;
                --background-color: #121212;
                --surface-color: #1e1e1e;
                --text-color: #e0e0e0;
                --text-muted-color: #888;
                --border-color: #333;
                --shadow-color: rgba(0, 0, 0, 0.5);
            }
            body {
                font-family: 'Inter', sans-serif;
                background-color: var(--background-color);
                color: var(--text-color);
                margin: 0;
                padding: 20px;
            }
            .container {
                max-width: 1000px;
                margin: 20px auto;
                display: flex;
                flex-direction: column;
                gap: 30px;
            }
            .header {
                text-align: center;
            }
            .header h1 {
                font-weight: 700;
                font-size: 2.8rem;
                color: var(--primary-color);
                text-shadow: 0 0 15px rgba(0, 124, 240, 0.5);
            }
            .main-engine {
                background: var(--surface-color);
                border-radius: 16px;
                padding: 30px;
                box-shadow: 0 8px 30px var(--shadow-color);
                border: 1px solid var(--border-color);
            }
            textarea {
                width: 100%;
                min-height: 100px;
                background: var(--background-color);
                border: 1px solid var(--border-color);
                color: var(--text-color);
                border-radius: 12px;
                padding: 15px;
                font-size: 1.1rem;
                resize: vertical;
                transition: border-color 0.3s, box-shadow 0.3s;
            }
            textarea:focus {
                outline: none;
                border-color: var(--primary-color);
                box-shadow: 0 0 10px rgba(0, 124, 240, 0.4);
            }
            .audio-controls { margin-top: 20px; }
            .output-area {
                display: flex;
                flex-wrap: wrap;
                align-items: center;
                gap: 15px;
                min-height: 50px;
                margin-top: 20px;
            }
            #generate-btn, .download-btn {
                background-color: var(--primary-color);
                color: white;
                border: none;
                border-radius: 10px;
                padding: 12px 25px;
                font-size: 1rem;
                font-weight: 600;
                cursor: pointer;
                transition: background-color 0.3s, transform 0.2s;
            }
            #generate-btn:hover, .download-btn:hover {
                background-color: #005bb5;
                transform: translateY(-2px);
            }
            #generate-btn:disabled {
                background-color: #555;
                cursor: not-allowed;
            }
            audio {
                flex-grow: 1;
                max-width: 400px;
            }
            .error-message {
                color: #ff8a80;
                padding: 15px;
                border: 1px solid #ff8a80;
                border-radius: 10px;
                background-color: rgba(255, 138, 128, 0.1);
            }
            .error-message a { color: #80d8ff; }
            .voice-selection h2 {
                text-align: center;
                margin-bottom: 10px;
            }
            .filter-buttons {
                display: flex;
                justify-content: center;
                gap: 10px;
                margin-bottom: 20px;
            }
            .filter-btn {
                background: var(--surface-color);
                border: 1px solid var(--border-color);
                color: var(--text-muted-color);
                padding: 8px 16px;
                border-radius: 8px;
                cursor: pointer;
                transition: all 0.3s;
            }
            .filter-btn:hover { background: #333; color: var(--text-color); }
            .filter-btn.active {
                background: var(--primary-color);
                color: white;
                border-color: var(--primary-color);
            }
            .voice-gallery {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
                gap: 20px;
            }
            .voice-card {
                background: var(--surface-color);
                border: 1px solid var(--border-color);
                border-radius: 12px;
                padding: 20px;
                cursor: pointer;
                transition: transform 0.3s, box-shadow 0.3s, border-color 0.3s;
            }
            .voice-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 10px 20px var(--shadow-color);
            }
            .voice-card.selected {
                border-color: var(--primary-color);
                box-shadow: 0 0 15px rgba(0, 124, 240, 0.4);
            }
            .voice-card h3 { margin: 0 0 5px 0; font-size: 1.1rem; }
            .voice-card p { margin: 0; font-size: 0.9rem; color: var(--text-muted-color); }
        </style>
    </head>
    <body>
        <div class="container">
            <header class="header">
                <h1>‚´∑ùêÖùêÄùêä ùêéùêÖùêÖùêàùêÇùêàùêÄùêã‚´∏</h1>
            </header>

            <main class="main-engine">
                <textarea id="text-input" placeholder="Enter text here..."></textarea>
                <div class="audio-controls">
                    <button id="generate-btn">Generate Audio</button>
                    <div class="output-area" id="output-area"></div>
                </div>
            </main>

            <section class="voice-selection">
                <h2>Choose a Voice</h2>
                <div class="filter-buttons" id="filter-buttons">
                    <button class="filter-btn active" data-lang="All">All</button>
                    <button class="filter-btn" data-lang="English">English</button>
                    <button class="filter-btn" data-lang="Urdu">Urdu</button>
                </div>
                <div class="voice-gallery" id="voice-gallery"></div>
            </section>
        </div>

        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const voiceGallery = document.getElementById('voice-gallery');
                const textInput = document.getElementById('text-input');
                const generateBtn = document.getElementById('generate-btn');
                const outputArea = document.getElementById('output-area');
                const filterButtons = document.getElementById('filter-buttons');

                const voicePresets = [{"id":"v2/en_speaker_6","name":"Nathan","language":"English","description":"Male, Calm & Clear","isDefault":true},{"id":"v2/en_speaker_9","name":"Luna","language":"English","description":"Female, Expressive"},{"id":"v2/en_speaker_1","name":"Arthur","language":"English","description":"Male, Deep & Warm"},{"id":"v2/en_speaker_4","name":"Ivy","language":"English","description":"Female, Gentle"},{"id":"v2/en_speaker_2","name":"Oscar","language":"English","description":"Male, Formal"},{"id":"v2/ur_speaker_0","name":"Zara","language":"Urdu","description":"Female, Gentle & Clear"},{"id":"v2/ur_speaker_1","name":"Bilal","language":"Urdu","description":"Male, Professional"},{"id":"v2/ur_speaker_2","name":"Samira","language":"Urdu","description":"Female, Bright"},{"id":"v2/fr_speaker_1","name":"Chlo√©","language":"French","description":"Female, Cheerful"},{"id":"v2/hi_speaker_0","name":"Priya","language":"Hindi","description":"Female, Bright"},{"id":"v2/zh_speaker_4","name":"Lin","language":"Chinese","description":"Female, Friendly"},{"id":"v2/es_speaker_1","name":"Sofia","language":"Spanish","description":"Female, Expressive"}];
                let selectedVoiceId = 'v2/en_speaker_6';
                
                const renderVoices = (filter = 'All') => {
                    voiceGallery.innerHTML = '';
                    const filteredVoices = filter === 'All' ? voicePresets : voicePresets.filter(v => v.language === filter);
                    
                    filteredVoices.forEach(voice => {
                        const card = document.createElement('div');
                        card.className = 'voice-card';
                        card.dataset.voiceId = voice.id;
                        card.innerHTML = `<h3>${voice.name}</h3><p>${voice.language} - ${voice.description}</p>`;
                        
                        if (voice.id === selectedVoiceId) {
                            card.classList.add('selected');
                        }

                        card.addEventListener('click', () => {
                            const currentSelected = document.querySelector('.voice-card.selected');
                            if (currentSelected) currentSelected.classList.remove('selected');
                            card.classList.add('selected');
                            selectedVoiceId = voice.id;
                        });
                        voiceGallery.appendChild(card);
                    });
                };

                filterButtons.addEventListener('click', (e) => {
                    if (e.target.tagName === 'BUTTON') {
                        document.querySelector('.filter-btn.active').classList.remove('active');
                        e.target.classList.add('active');
                        renderVoices(e.target.dataset.lang);
                    }
                });
                
                textInput.addEventListener('input', () => {
                    // Smart detection for Urdu script
                    const urduRegex = /[\u0600-\u06FF]/;
                    if (urduRegex.test(textInput.value)) {
                        const urduFilter = document.querySelector('.filter-btn[data-lang="Urdu"]');
                        if (!urduFilter.classList.contains('active')) {
                            document.querySelector('.filter-btn.active').classList.remove('active');
                            urduFilter.classList.add('active');
                            renderVoices('Urdu');
                            // Auto-select the first Urdu voice if not already on an Urdu voice
                            const isUrduSelected = voicePresets.find(v => v.id === selectedVoiceId)?.language === 'Urdu';
                            if (!isUrduSelected) {
                                const firstUrduVoice = voicePresets.find(v => v.language === 'Urdu');
                                if (firstUrduVoice) {
                                    selectedVoiceId = firstUrduVoice.id;
                                    document.querySelector('.voice-card.selected')?.classList.remove('selected');
                                    document.querySelector(`.voice-card[data-voice-id="${firstUrduVoice.id}"]`)?.classList.add('selected');
                                }
                            }
                        }
                    }
                });

                generateBtn.addEventListener('click', async () => {
                    const text = textInput.value.trim();
                    if (!text) {
                        alert('Please enter some text.');
                        return;
                    }

                    generateBtn.disabled = true;
                    generateBtn.textContent = 'Generating...';
                    outputArea.innerHTML = '';

                    try {
                        const response = await fetch('/api/generate', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ text, voice_preset: selectedVoiceId })
                        });

                        if (response.ok) {
                            const audioBlob = await response.blob();
                            const audioUrl = URL.createObjectURL(audioBlob);

                            const audioPlayer = new Audio(audioUrl);
                            audioPlayer.controls = true;
                            audioPlayer.autoplay = true;

                            const downloadBtn = document.createElement('a');
                            downloadBtn.href = audioUrl;
                            downloadBtn.download = 'fak_official_tts.wav';
                            downloadBtn.className = 'download-btn';
                            downloadBtn.textContent = 'Download Audio';
                            
                            outputArea.appendChild(audioPlayer);
                            outputArea.appendChild(downloadBtn);
                        } else {
                            throw new Error('Failed to generate audio from API.');
                        }
                    } catch (error) {
                        outputArea.innerHTML = `
                            <div class="error-message">
                                <p>System under Development. Please try again later.</p>
                                <p>For support, join our <a href="https://whatsapp.com/channel/0029Vb2y2umF6sn16F6Zm20k" target="_blank">WhatsApp Channel</a>.</p>
                            </div>
                        `;
                    } finally {
                        generateBtn.disabled = false;
                        generateBtn.textContent = 'Generate Audio';
                    }
                });

                // Initial render
                renderVoices();
            });
        </script>
    </body>
    </html>
